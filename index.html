<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudMail Pro - Mail & Storage Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        .mesh-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .btn-glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }

        .btn-glass:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .file-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .input-glass::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-glass:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-active {
            background: rgba(255, 255, 255, 0.3);
            border-bottom: 2px solid white;
        }
    </style>
</head>
<body class="mesh-gradient min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-3xl p-8 mb-6">
            <h1 class="text-5xl font-bold text-white mb-2">‚òÅÔ∏è CloudMail Pro</h1>
            <p class="text-white/80 text-lg">Your Premium Mail & Storage Solution</p>
        </div>

        <!-- Tab Navigation -->
        <div class="glass-card rounded-3xl p-2 mb-6 flex gap-2">
            <button onclick="switchTab('mail')" id="tab-mail" class="tab-active flex-1 py-3 px-6 rounded-2xl text-white font-semibold transition-all">
                üìß Mail Service
            </button>
            <button onclick="switchTab('storage')" id="tab-storage" class="flex-1 py-3 px-6 rounded-2xl text-white/80 font-semibold transition-all hover:bg-white/10">
                üíæ Cloud Storage
            </button>
        </div>

        <!-- Mail Service Section -->
        <div id="mail-section" class="space-y-6">
            <div class="glass-card rounded-3xl p-8">
                <h2 class="text-3xl font-bold text-white mb-6">‚úâÔ∏è Send Email</h2>
                
                <form id="mail-form" class="space-y-4">
                    <div>
                        <label class="block text-white/90 mb-2 font-medium">To:</label>
                        <input type="email" id="mail-to" required 
                               class="input-glass w-full px-4 py-3 rounded-xl"
                               placeholder="recipient@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-white/90 mb-2 font-medium">Subject:</label>
                        <input type="text" id="mail-subject" required 
                               class="input-glass w-full px-4 py-3 rounded-xl"
                               placeholder="Enter subject">
                    </div>
                    
                    <div>
                        <label class="block text-white/90 mb-2 font-medium">Message:</label>
                        <textarea id="mail-message" required rows="6"
                                  class="input-glass w-full px-4 py-3 rounded-xl resize-none"
                                  placeholder="Type your message here..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn-glass w-full py-4 rounded-xl text-white font-semibold text-lg">
                        üöÄ Send Email
                    </button>
                </form>

                <div id="mail-status" class="mt-4 hidden p-4 rounded-xl"></div>
            </div>
        </div>

        <!-- Cloud Storage Section -->
        <div id="storage-section" class="hidden space-y-6">
            <!-- Upload Section -->
            <div class="glass-card rounded-3xl p-8">
                <h2 class="text-3xl font-bold text-white mb-6">üì§ Upload File</h2>
                
                <form id="upload-form" class="space-y-4">
                    <div>
                        <label class="block text-white/90 mb-2 font-medium">Choose File:</label>
                        <input type="file" id="file-input" required 
                               class="input-glass w-full px-4 py-3 rounded-xl file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-white/20 file:text-white file:font-semibold hover:file:bg-white/30">
                    </div>
                    
                    <button type="submit" class="btn-glass w-full py-4 rounded-xl text-white font-semibold text-lg">
                        ‚¨ÜÔ∏è Upload File
                    </button>
                </form>

                <div id="upload-status" class="mt-4 hidden p-4 rounded-xl"></div>
            </div>

            <!-- File List Section -->
            <div class="glass-card rounded-3xl p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white">üìÅ Your Files</h2>
                    <button onclick="loadFiles()" class="btn-glass px-6 py-2 rounded-xl text-white font-semibold">
                        üîÑ Refresh
                    </button>
                </div>
                
                <div id="files-list" class="space-y-3">
                    <!-- Files will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // Tab Switching
        function switchTab(tab) {
            const mailSection = document.getElementById('mail-section');
            const storageSection = document.getElementById('storage-section');
            const mailTab = document.getElementById('tab-mail');
            const storageTab = document.getElementById('tab-storage');

            if (tab === 'mail') {
                mailSection.classList.remove('hidden');
                storageSection.classList.add('hidden');
                mailTab.classList.add('tab-active');
                storageTab.classList.remove('tab-active');
                mailTab.classList.add('text-white');
                storageTab.classList.remove('text-white');
                storageTab.classList.add('text-white/80');
            } else {
                storageSection.classList.remove('hidden');
                mailSection.classList.add('hidden');
                storageTab.classList.add('tab-active');
                mailTab.classList.remove('tab-active');
                storageTab.classList.add('text-white');
                mailTab.classList.remove('text-white');
                mailTab.classList.add('text-white/80');
                loadFiles();
            }
        }

        // Mail Service
        document.getElementById('mail-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const to = document.getElementById('mail-to').value;
            const subject = document.getElementById('mail-subject').value;
            const text = document.getElementById('mail-message').value;
            const statusDiv = document.getElementById('mail-status');

            try {
                statusDiv.className = 'mt-4 p-4 rounded-xl glass';
                statusDiv.innerHTML = '<p class="text-white">üìß Sending email...</p>';
                statusDiv.classList.remove('hidden');

                const response = await fetch(`${API_BASE}/api/mail/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to, subject, text, html: `<p>${text}</p>` })
                });

                const data = await response.json();

                if (data.success) {
                    statusDiv.className = 'mt-4 p-4 rounded-xl bg-green-500/30 border border-green-400/50';
                    statusDiv.innerHTML = '<p class="text-white font-semibold">‚úÖ Email sent successfully!</p>';
                    document.getElementById('mail-form').reset();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                statusDiv.className = 'mt-4 p-4 rounded-xl bg-red-500/30 border border-red-400/50';
                statusDiv.innerHTML = `<p class="text-white font-semibold">‚ùå Error: ${error.message}</p>`;
            }
        });

        // File Upload
        document.getElementById('upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fileInput = document.getElementById('file-input');
            const statusDiv = document.getElementById('upload-status');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                statusDiv.className = 'mt-4 p-4 rounded-xl glass';
                statusDiv.innerHTML = '<p class="text-white">‚¨ÜÔ∏è Uploading file...</p>';
                statusDiv.classList.remove('hidden');

                const response = await fetch(`${API_BASE}/api/storage/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    statusDiv.className = 'mt-4 p-4 rounded-xl bg-green-500/30 border border-green-400/50';
                    statusDiv.innerHTML = '<p class="text-white font-semibold">‚úÖ File uploaded successfully!</p>';
                    document.getElementById('upload-form').reset();
                    loadFiles();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                statusDiv.className = 'mt-4 p-4 rounded-xl bg-red-500/30 border border-red-400/50';
                statusDiv.innerHTML = `<p class="text-white font-semibold">‚ùå Error: ${error.message}</p>`;
            }
        });

        // Load Files
        async function loadFiles() {
            const filesList = document.getElementById('files-list');
            
            try {
                filesList.innerHTML = '<p class="text-white/80">Loading files...</p>';
                
                const response = await fetch(`${API_BASE}/api/storage/files`);
                const data = await response.json();

                if (data.success && data.files.length > 0) {
                    filesList.innerHTML = data.files.map(file => `
                        <div class="file-item p-4 rounded-xl flex justify-between items-center">
                            <div class="flex-1">
                                <p class="text-white font-semibold">${file.filename}</p>
                                <p class="text-white/60 text-sm">${formatFileSize(file.size)} ‚Ä¢ ${new Date(file.uploadedAt).toLocaleString()}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="downloadFile('${file.filename}')" 
                                        class="btn-glass px-4 py-2 rounded-lg text-white text-sm">
                                    ‚¨áÔ∏è Download
                                </button>
                                <button onclick="deleteFile('${file.filename}')" 
                                        class="bg-red-500/30 border border-red-400/50 px-4 py-2 rounded-lg text-white text-sm hover:bg-red-500/40">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    filesList.innerHTML = '<p class="text-white/60 text-center py-8">No files uploaded yet</p>';
                }
            } catch (error) {
                filesList.innerHTML = `<p class="text-red-400">Error loading files: ${error.message}</p>`;
            }
        }

        // Download File
        function downloadFile(filename) {
            window.location.href = `${API_BASE}/api/storage/download/${filename}`;
        }

        // Delete File
        async function deleteFile(filename) {
            if (!confirm(`Delete ${filename}?`)) return;

            try {
                const response = await fetch(`${API_BASE}/api/storage/files/${filename}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    loadFiles();
                } else {
                    alert('Failed to delete file');
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        // Format File Size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Initialize
        loadFiles();
    </script>
</body>
</html>
